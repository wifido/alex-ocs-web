/*! ocs-web 2016-08-11 */
define(["angular"],function(a){"use strict";return a.module("appCtrls.userCtrls",[]).controller("authCtrl",["$scope","$state","$rootScope","$cookies","authBiz","shopBiz","$ocsPopup","SystemConfig",function(b,c,d,e,f,g,h,i){b.user={password:"",username:""},b.auth=function(){return b.user.username?b.user.password?void f.auth(b.user).then(function(b){d.authUser=b,g.shopDetail(null).then(function(b){if(b.success){d.authUser=b.object;var c=new Date;c.setDate(c.getDate()+7),e.put("authUser",a.toJson(b.object),{expires:c});var g=d.authUser.userType,j=d.authUser.levelType;0==g&&2==j?e.put("userRole",i.userRole.business_important,{expires:c}):1==g&&2==j?e.put("userRole",i.userRole.store_important,{expires:c}):0==g&&1==j?e.put("userRole",i.userRole.business_normal,{expires:c}):1==g&&1==j?e.put("userRole",i.userRole.store_normal,{expires:c}):(e.put("userRole",i.userRole.other,{expires:c}),h.growl("该用户未分配任何权限",{type:"danger"})),f.goMainStateByRole(e.get("userRole"))}else h.growl(b.errorInfo,{type:"danger"})},function(a){h.growl(a.text,{type:"danger"})})},function(a){h.growl(a.text,{type:"danger"})}):(h.growl("请输入密码",{type:"danger"}),void $("#password")[0].focus()):(h.growl("请输入用户名",{type:"danger"}),void $("#username")[0].focus())}}]).controller("pwdCtrl",["$scope","$state","$rootScope","$cookies","authBiz","$ocsPopup",function(a,b,c,d,e,f){a.query={username:"",originPass:"",newPass:""},a.newPassConfirm="",a.changePwd=function(){function b(a){return/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,.\/]).{6,10}$/.test(a)}return a.query.username?a.query.originPass?a.query.newPass?a.query.originPass==a.query.newPass?(f.growl("新密码不可与旧密码一样",{type:"danger"}),a.query.newPass="",a.newPassConfirm="",void $("#newPass")[0].focus()):b(a.query.newPass)?a.newPassConfirm?a.query.newPass!=a.newPassConfirm?(f.growl("请确认正确的新密码",{type:"danger"}),a.newPassConfirm="",void $("#newPassConfirm")[0].focus()):void e.changePwd(a.query).then(function(b){b.success?(f.growl("修改密码成功,请重新登录",{type:"success"}),c.logout()):(f.growl("旧密码错误，请重新输入",{type:"danger"}),a.query.newPass="",a.query.originPass="",a.newPassConfirm="",$("#originPass")[0].focus())},function(a){f.growl(a.text,{type:"danger"})}):(f.growl("请确认新密码",{type:"danger"}),void $("#newPassConfirm")[0].focus()):(f.growl("新密码必须由6-10位字母、数字、特殊符号组成",{type:"danger"}),a.query.newPass="",a.newPassConfirm="",void $("#newPass")[0].focus()):(f.growl("请输入新密码",{type:"danger"}),void $("#newPass")[0].focus()):(f.growl("请输入旧密码",{type:"danger"}),void $("#originPass")[0].focus()):(f.growl("请输入用户名",{type:"danger"}),void $("#username")[0].focus())}}])});