/*! ocs-web 2016-09-26 */
define(["angular"],function(a){"use strict";return a.module("appBizs.userBizs",[]).service("authBiz",["$http","$q","$cookies","$base64","$state","promiseService","SystemConfig",function(a,b,c,d,e,f,g){return{auth:function(e){var f=b.defer(),h={method:"POST",url:g.ocs_url+g.url_auth,headers:{"ocs-client-id":"O2O-Business-Web","x-up-Authorization":"B-Token "+d.encode(e.username+":"+e.password)},timeout:1e4};return a(h).success(function(a){if("login error"!=a){var b=new Date;b.setDate(b.getDate()+1),c.put("B-token",a,{expires:b}),f.resolve(a)}else f.reject({type:"warning",text:"login error"==a?"账号或密码错误":"网络异常",data:a,config:h})}).error(function(a,b,c,d){f.reject({type:"warning",text:"login error"==a?"账号或密码错误":"网络异常",data:a,config:d})}),f.promise},changePwd:function(a){return f.getPromise(g.url_changePwd,a,"POST")},userHasRole:function(a){var b=g.userRole;for(var c in b)if(a==b[c])return!0;return!1},isRouteStateAccessibleForUser:function(a,b){var c=g.userRole,d=g.userRoleRouteMap;for(var e in c)if(a==c[e]){var f=d[a];if(f)for(var h=0;h<f.length;h++)if(f[h]==b)return!0}return!1},isButtonAccessibleForUser:function(a,b){var c=g.userRole,d=g.userRoleButtonMap;for(var e in c)if(a==c[e]){var f=d[a];if(f)for(var h=0;h<f.length;h++)if(f[h]==b)return!0}return!1},goMainStateByRole:function(a){var b=g.userRole;switch(a){case b.business_important:e.go("main.merChantManager");break;case b.store_important:e.go("main.orderCreate");break;case b.business_normal:e.go("main.orderCreate");break;case b.store_normal:e.go("main.orderCreate")}}}}])});